<!DOCTYPE html>
<!-- Designined by CodingLab | www.youtube.com/codinglabyt -->
<html lang="en" dir="ltr">
  <head>
    <meta charset="UTF-8">
    <!--<title> Responsiive Admin Dashboard | CodingLab </title>-->
    <link rel="stylesheet" href="teachers.css">
    <!-- Boxicons CDN Link -->
    <link href='https://unpkg.com/boxicons@2.0.7/css/boxicons.min.css' rel='stylesheet'>
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
   </head>
<body>
  <div class="sidebar">
    <div class="logo-details">
      <i class='bx bxl-c-plus-plus'></i>
      <span class="logo_name">Farbe</span>
    </div>
      <ul class="nav-links">
        <li>
          <a href="admindashboard.html" class="active1">
            <i class='bx bx-grid-alt' ></i>
            <span class="links_name">Dashboard</span>
          </a>
        </li>
        <li>
          <a href="teachers.html" class="active">
            <i class='bx bx-box' ></i>
            <span class="links_name">Teachers</span>
          </a>
        </li>
        <li>
          <a href="students.html">
            <i class='bx bx-list-ul' ></i>
            <span class="links_name">Students</span>
          </a>
        </li>
        <li>
          <a href="courses.html">
            <i class='bx bx-pie-chart-alt-2' ></i>
            <span class="links_name">Courses</span>
          </a>
        </li>
        <li>
          <a href="groups.html">
            <i class='bx bx-heart' ></i>
            <span class="links_name">Groups</span>
          </a>
        </li>
        <li>
          <a href="#">
            <i class='bx bx-coin-stack' ></i>
            <span class="links_name">Posters</span>
          </a>
        </li>
        <li>
          <a href="#">
            <i class='bx bx-book-alt' ></i>
            <span class="links_name">Webinar Booking</span>
          </a>
        </li>
        <li>
          <a href="classbooking.html">
            <i class='bx bx-user' ></i>
            <span class="links_name">Class Booking</span>
          </a>
        </li>
        <li>
          <a href="#">
            <i class='bx bx-message' ></i>
            <span class="links_name">Recorded Classes</span>
          </a>
        </li>
        <li>
          <a href="#">
            <i class='bx bx-cog' ></i>
            <span class="links_name">Settings</span>
          </a>
        </li>
        <li class="log_out">
          <a href="#">
            <i class='bx bx-log-out'></i>
            <span class="links_name">Log out</span>
          </a>
        </li>
      </ul>
  </div>
  <section class="home-section">
    <nav>
      <div class="sidebar-button">
        <i class='bx bx-menu sidebarBtn'></i>
        <span class="dashboard">Dashboard</span>
      </div>
      <div class="search-box">
        <input type="text" placeholder="Search...">
        <i class='bx bx-search' ></i>
      </div>
      <div class="profile-details">
        <!--<img src="images/profile.jpg" alt="">-->
        <span class="admin_name">Admin</span>
        <i class='bx bx-chevron-down' ></i>
      </div>
    </nav>

    <div class="home-content">
      <div class="overview-boxes">
        <div class="box">
          <div class="right-side">
            <div class="box-topic">Total Teachers</div>
            <div class="teachernumber">0</div>
          </div>
        </div>
        <div class="box">
          <div class="right-side">
            <div class="box-topic">Total Booked Classes</div>
            <div class="classnumber">0</div>
          </div>
        </div>
        <div class="box">
          <div class="right-side">
            <div class="box-topic">Total Students</div>
            <div class="studentnumber">0</div>
          </div>
        </div>
        <div class="box">
          <div class="right-side">
            <div class="box-topic">Total Courses</div>
            <div class="coursenumber">0</div>
          </div>
        </div>
      </div>

    

      <div class="sales-boxes">
        <div class="top-sales box">
          <div class="teachers">
          <div class="title">Teachers</div>
          <ul class="top-sales-details">
            <ul id="myList">
            
            </ul>
          </div>
         
         
        </div>

        <div class="recent-sales box">
          <div class="title">Teacher Details</div>
          <div class="teacherdetails"> 
          <div class="teachername">
            <div class="namet">Teacher Name : </div>
            <div class="name1"></div>
          </div>
          <div class="teachermail">
            <div class="mailt">Teacher EmailId : </div>
            <div class="mail"></div>
          </div>
          <div class="teacherpassword">
            <div class="passwordt">Teacher Password : </div>
            <div class="passwordtt"></div>
          </div>
          <div class="teachercontact">
            <div class="contactt">Teacher Contact Number : </div>
            <div class="contact"></div>
          </div>
          <div class="teachercourse">
            <div class="courset">Teacher Course : </div>
            <div class="course"></div>
          </div>
          <div class="teacherresume">
            <div class="cvt">Teacher CV : </div>
            <a id="link" download>No file Available</a>  
                    </div>
                       </div>
          <div class="sales-details">
            <ul class="details">
                <div class="button">
                  <a id="button1">Add teacher details</button>
                  </div>

                  <!-- The Modal -->
                  <div id="myModal" class="modal">
                  
                    <!-- Modal content -->
                    <div class="modal-content">
                      <span class="close">&times;</span>
                      <div class="forms-out">
                        <div class="forms-in">
                          <div id="registration-page" >
                              <button id="show-home">Home</button>
                            <h3>Add details</h3>
                            Name <br />
                            <input type="email" id="registration-name" /><br />
                            Course <br />
                            <input type="email" id="registration-course" /><br />
                            Contact Number <br />
                            <input type="tel" id="registration-number" /><br />
                            Email <br />
                            <input type="email" id="registration-email" /><br />
                            Confirm Email <br />
                            <input
                              type="email"
                              id="registration-reemail"
                              autocomplete="off"
                            /><br />
                            Password <br />
                            <input type="password" id="registration-password" /><br />
                            Add your resume <br />
                            <input type="file" onchange="uploadFile()" id="files" name="files[]" multiple  />
                            <a id="link1" download></a>  

                            <center><button id="register">Submit</button></center>
                          </div>
                  
                          <div id="login-page" class="hide">
                            <button id="show-register">Sign Up</button>
                            <h3>Sign In</h3>
                            Email <br />
                            <input type="email" id="login-email" /><br />
                            Password <br />
                            <input type="password" id="login-password" /><br />
                            <p id="forgot-password">Forgot Password</p>
                            <center><button id="login">Sign In</button></center>
                          </div>
                  
                         
                        </div>                    </div>
                  
                  </div>
          </div>
         
        </div>
      
      </div>
    </div>
  </section>
<script src="teachers.js"></script>
  <!-- The core Firebase JS SDK is always required and must be listed first -->
  <script src="https://www.gstatic.com/firebasejs/7.14.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.14.1/firebase-storage.js"></script>       
  <!-- TODO: Add SDKs for Firebase products that you want to use-->
  <script src="https://www.gstatic.com/firebasejs/7.14.1/firebase-auth.js"></script>
   <script src="https://www.gstatic.com/firebasejs/7.14.1/firebase-database.js"></script>
 <script>
   // Your web app's Firebase configuration
   var  firebaseConfig = {
 apiKey: "AIzaSyAPUZL6sv9HLFZWwqvi0FwC7bQGHg_FB5U",
 authDomain: "wireless-buzzer-5da2e.firebaseapp.com",
 databaseURL: "https://wireless-buzzer-5da2e-default-rtdb.firebaseio.com",
 projectId: "wireless-buzzer-5da2e",
 storageBucket: "wireless-buzzer-5da2e.appspot.com",
 messagingSenderId: "32882967911",
 appId: "1:32882967911:web:0e58f308bbda83cbd2dbc2"
};
   // Initialize Firebase
   firebase.initializeApp(firebaseConfig);
 </script>
  <script>
       const auth = firebase.auth();
      var database = firebase.database();
      var file1,oldfilename;
      const link = document.getElementById('link');
      const files = document.getElementById('link1');
      var update=false;
      function uploadFile(){
        link1.innerText = ""
      update = false;
      // Created a Storage Reference with root dir
      var storageRef = firebase.storage().ref();
      // Get the file from DOM
      file1 = document.getElementById("files").files[0];
      console.log(file1);
      
      //dynamically set reference to the file name
      var thisRef = storageRef.child(file1.name);

      //put request upload file to firebase storage
      thisRef.put(file1).then(function(snapshot) {
        
      });
    }

    var teachers_data = [],email_data = []
    var course_data = [],contact_data = [],cv_data = [],cv_data1 = [],password_data=[];
    var key,name_val,course_val,cv_val,cv_val1,password_val;
 var userDataRef = firebase.database().ref("users/teachers").orderByKey();
userDataRef.once("value").then(function(snapshot) {
snapshot.forEach(function(childSnapshot) {
   key = childSnapshot.key;
  var childData = childSnapshot.val();              
  name_val = childSnapshot.val().username;
  course_val = childSnapshot.val().course;
  cv_val = childSnapshot.val().resume;
  password_val = childSnapshot.val().password;
  teachers_data.push(name_val)
  course_data.push(course_val)
  cv_data.push(cv_val)
  email_data.push(childSnapshot.val().email)
  contact_data.push(childSnapshot.val().mobilenumber)
  password_data.push(childSnapshot.val().password)
  console.log(password_data[0]);
  });
  let list = document.getElementById("myList");
  list.style.width = "350px"
  teachers_data.forEach((item)=>{
  let li = document.createElement("li");
  let a = document.createElement("a");
  let a1 = document.createElement("a");
  a.text = "more info"
  a.style.backgroundColor="lightblue";
  a.style.color = "black";
  a.style.borderRadius = "5px";
  a.style.padding = "3px";
  a.style.width = "90px"
  a.style.position = "relative"
  a1.text = "Edit info" 
  a1.style.width = "90px";
  a1.style.backgroundColor="black";
  a1.style.color = "lightblue";
  a1.style.borderRadius = "5px";
  a1.style.paddingLeft = "12px";
  var index = teachers_data.indexOf(item); 

  a.addEventListener("click",()=>{
    document.querySelector(".name1").innerHTML = teachers_data[index];
    document.querySelector(".course").innerHTML = course_data[index];
    document.querySelector(".mail").innerHTML = email_data[index];
    document.querySelector(".contact").innerHTML = contact_data[index];
    document.querySelector(".passwordtt").innerHTML = password_data[index];
    if(cv_data[index]!=null)
    {
      link.innerHTML = "Click here to download CV"
    }
    else{
      link.innerHTML = "No file available"
    }
    getFileUrl(cv_data[index])
    
  });

  a1.addEventListener("click",()=>{
    modal.style.display = "block";
    document.querySelector("#registration-name").value = teachers_data[index];
    document.querySelector("#registration-course").value = course_data[index];
    document.querySelector("#registration-number").value = contact_data[index];
    document.querySelector("#registration-email").value = email_data[index];
    document.querySelector("#registration-reemail").value = email_data[index];
    document.querySelector("#registration-password").value = password_data[index];
    update = true;
    link1.innerHTML = cv_data[index];
  })

  li.innerText = item;
  li.style.color = "black"
  li.style.fontWeight = 500
    li.appendChild(a)
    li.append(a1);
  list.appendChild(li);
 
})

});

function getFileUrl(filename) {
//create a storage reference
var storage = firebase.storage().ref(filename);

//get file url
storage
.getDownloadURL()
.then(function(url) {
  console.log(url);
  link.href = url;
})
.catch(function(error) {
  console.log("error encountered");
});
}

var teachers_data2 = [],class_data2=[],course_data2=[],students_data2=[];  
 var userDataRef = firebase.database().ref("users/teachers").orderByKey();
userDataRef.once("value").then(function(snapshot) {
snapshot.forEach(function(childSnapshot) {
            
  var name_val = childSnapshot.val().username;
  teachers_data2.push(name_val);
  });
  document.querySelector(".teachernumber").innerText =   teachers_data2.length;
});
firebase.database().ref("users/students").orderByKey().once("value").then(function(snapshot) {
snapshot.forEach(function(childSnapshot) {
  var name_val = childSnapshot.val().username;
  students_data2.push(name_val);
  });
  document.querySelector(".studentnumber").innerText =   students_data2.length;
});

firebase.database().ref("classes/booked").orderByKey().once("value").then(function(snapshot) {
snapshot.forEach(function(childSnapshot) {
  var name_val = childSnapshot.val().teachername;
  class_data2.push(name_val);
  });
  document.querySelector(".classnumber").innerText =   class_data2.length;
});

firebase.database().ref("courses").orderByKey().once("value").then(function(snapshot) {
snapshot.forEach(function(childSnapshot) {
  var name_val = childSnapshot.val().course;
  course_data2.push(name_val);
  });
  document.querySelector(".coursenumber").innerText =   course_data2.length;
});

   let sidebar = document.querySelector(".sidebar");
let sidebarBtn = document.querySelector(".sidebarBtn");
sidebarBtn.onclick = function() {
  sidebar.classList.toggle("active");
  if(sidebar.classList.contains("active")){
  sidebarBtn.classList.replace("bx-menu" ,"bx-menu-alt-right");
}else
  sidebarBtn.classList.replace("bx-menu-alt-right", "bx-menu");
}

document.querySelector("#show-register").addEventListener("click", () => {
        showRegistration();
      });

      const showRegistration = () => {
        document.querySelector("#registration-page").classList.remove("hide");
        document.querySelector("#login-page").classList.add("hide");
        document.querySelector("#homepage").classList.add("hide");
      };


      document.querySelector("#show-home").addEventListener("click",()=>{
          location.href="teachers.html"
      })
    
var valuefile;

     const register = () => {
      if(update)
    {

      valuefile = link1.innerText;
    }
    else{
      valuefile = file1.name;

    }
    
        const email = document.querySelector("#registration-email").value;
        const reemail = document.querySelector("#registration-reemail").value;
        const password = document.querySelector("#registration-password").value;
        const name = document.querySelector("#registration-name").value;
        const course = document.querySelector("#registration-course").value;
        const number = document.querySelector("#registration-number").value; 
       
        if (name.trim() == "") {
          alert("Enter your Name");
        }
        else if (course.trim() == "") {
          alert("Enter Course Name");
        }
        else if (number.trim() == "") {
          alert("Enter contact Number");
        }
        else if (email.trim() == "") {
          alert("Enter Email");
        }
        else if (password.trim().length < 7) {
          alert("Password must be at least 7 characters");
        } else if (email != reemail) {
          alert("emails do not match");
        } else {
          
          auth
            .createUserWithEmailAndPassword(email, password)
            database.ref('users/teachers/'+name+'/').set({
    username: name,
    mobilenumber:number,
    email: email,
    course : course,
    password:password,
    resume:valuefile

    })
    if(update)
    {
      alert("Teacher information updated")
      update = false;
      link1.innerText = ""
    }
    else{
      alert("Teacher information added")
      link1.innerText = ""

    }
    document.getElementById("registration-password").value=""
       document.getElementById("registration-email").value=""
       document.getElementById("registration-name").value=""
       document.getElementById("registration-number").value=""
       document.getElementById("registration-course").value=""
       document.getElementById("registration-reemail").value=""
    document.getElementById("registration-email").value=""
    link1.innerText = ""

            .catch(function (error) {
              // Handle Errors here.
              var errorCode = error.code;
              var errorMessage = error.message;
              alert(errorMessage);
              // ...
            });
        }
      };
     
   
      document.querySelector("#register").addEventListener("click", () => {
       register();
      });

      //register when you hit the enter key
      document
        .querySelector("#registration-password")
        .addEventListener("keyup", (e) => {
          if (event.keyCode === 13) {
            e.preventDefault();

            register();
          }
        });

      const login = () => {
        const email = document.querySelector("#login-email").value;
        const password = document.querySelector("#login-password").value;

        if (email.trim() == "") {
          alert("Enter Email");
        } else if (password.trim() == "") {
          alert("Enter Password");
        } else {
          authenticate(email, password);
        }
      };

      document.querySelector("#login").addEventListener("click", () => {
        login();
      });

      //sign in when you hit enter
      document
        .querySelector("#login-password")
        .addEventListener("keyup", (e) => {
          if (event.keyCode === 13) {
            e.preventDefault();

            login();
          }
        });

      const authenticate = (email, password) => {
        const auth = firebase.auth();
        auth.signInWithEmailAndPassword(email, password);
        firebase
          .auth()
          .signInWithEmailAndPassword(email, password)
          .catch(function (error) {
            // Handle Errors here.
            var errorCode = error.code;
            var errorMessage = error.message;
            alert(errorMessage);
          });
      };

      const showHomepage = () => {
        document.querySelector("#registration-page").classList.add("hide");
        document.querySelector("#login-page").classList.add("hide");
        document.querySelector("#homepage").classList.remove("hide");
      };

    

      

      document
        .querySelector("#forgot-password")
        .addEventListener("click", () => {
          const email = document.querySelector("#login-email").value;
          if (email.trim() == "") {
            alert("Enter Email");
          } else {
            forgotPassword(email);
          }
        });

      const forgotPassword = (email) => {
        auth
          .sendPasswordResetEmail(email)
          .then(function () {
            alert("email sent");
          })
          .catch(function (error) {
            alert("invalid email or bad network connection");
          });
      };

 </script>

</body>
</html>

